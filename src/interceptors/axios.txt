// 30초후에 토큰이 만료됨.
// 액세스 토큰이 만료되었기때문에
// 새로고침을 사용해서 다른 액세스 토큰 생성 interceptor라는 디렉토리를 만듬.

import axios from "axios";

axios.defaults.baseURL=`/api/`;
// 두번째 인터셉터를 사용하고 있다
// 새로고침 토큰을 위해 할것니다.

let refresh = false;

axios.interceptors.response.use(resp => resp, async error => {
    if(error.response.status === 401 && !refresh) {
        refresh = true;

        const response = await axios.post(`refresh`, {}, {withCredentials: true});

        if(response.status === 200) {
            axios.defaults.headers.common[`Authorization`] = `Bearer ${response.data.token}`;

            return axios(error.config);
        }
    }

    refresh = false;
    return error;
});